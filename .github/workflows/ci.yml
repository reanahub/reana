# This file is part of REANA.
# Copyright (C) 2020 CERN.
#
# REANA is free software; you can redistribute it and/or modify it
# under the terms of the MIT License; see LICENSE file for more details.

name: CI

on: [push, pull_request]

jobs:
  shell-lint:
    uses: ./.github/workflows/ci-shell-lint.yml@master

  python-lint:
    uses: ./.github/workflows/ci-python-lint.yml@master

  sphinx-docs:
    uses: ./.github/workflows/ci-sphinx-docs.yml@master
    with:
      install-graphviz: true
      install-libcurl: false

  python-test:
    uses: ./.github/workflows/ci-python-test.yml@master
    with:
      python-versions: "['3.6', '3.7', '3.8', '3.9']"
    secrets:
      codecov-token: ${{ secrets.CODECOV_TOKEN }}

  helm-lint:
    runs-on: ubuntu-20.04
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Fetch history
        run: git fetch --prune --unshallow

      - name: Run chart-testing (lint)
        id: lint
        uses: helm/chart-testing-action@v1.1.0
        with:
          command: lint
          config: .github/ct.yaml
